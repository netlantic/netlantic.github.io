<!doctype html>
<html>

<head>
  <title>P2P chat - netlantic.github.io</title>
  <meta property="og:title" content="The Rock" />
  <meta property="og:type" content="video.movie" />
  <meta property="og:url" content="http://www.imdb.com/title/tt0117500/" />
  <meta property="og:image" content="https://resizing.flixster.com/kHQpgsfOgZPdDLXBGpsAFhQjO2A=/206x305/v1.bTsxMTIwODU2MDtqOzE3OTA0OzEyMDA7MTUzNjsyMDQ4" />
  <script src="https://unpkg.com/ipfs/dist/index.min.js"></script>
  <script type="text/javascript">
    const topic = 'netlantic.github.io';
    const node = new Ipfs({
      repo: 'ipfs-' + Math.random(),
      config: {
        Addresses: {
          Swarm: [
            '/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star'
          ]
        }
      },
      EXPERIMENTAL: {
        pubsub: true
      }
    })
    node.once('ready', () => {
      document.getElementById("status").innerHTML = 'Node status: ' + (node.isOnline() ? 'online' : 'offline')

      const textarea = document.querySelector('#textarea');
      const receiveMsg = msg => textarea.value = (msg.data.toString());
      node.pubsub.subscribe(topic, receiveMsg)
      textarea.addEventListener('keyup', ({ target: { value } }) => {
        node.pubsub.publish(topic, node.types.Buffer(value));
      })

    })

  </script>
</head>

<body>

  <h1 id="status">Node status: offline</h1>
  <textarea id='textarea'></textarea>
</body>

</html>